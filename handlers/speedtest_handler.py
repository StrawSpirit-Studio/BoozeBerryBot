import speedtest

# –•–µ–Ω–¥–ª–µ—Ä –¥–ª—è —Ç–µ—Å—Ç—É —à–≤–∏–¥–∫–æ—Å—Ç—ñ
async def speedtest_handler(client, message):
    # –í–∏–≤–µ–¥–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ—á–∞—Ç–æ–∫ —Ç–µ—Å—Ç—É
    await message.edit_text("üîÑ **–ü–æ—á–∏–Ω–∞—é —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è —à–≤–∏–¥–∫–æ—Å—Ç—ñ –∑'—î–¥–Ω–∞–Ω–Ω—è...**\n–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞—á–µ–∫–∞–π—Ç–µ... ‚è≥")
    try:
        # –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –æ–±'—î–∫—Ç–∞ –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è —à–≤–∏–¥–∫–æ—Å—Ç—ñ
        st = speedtest.Speedtest()

        # –í–∏–±—ñ—Ä –Ω–∞–π–±–ª–∏–∂—á–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
        st.get_best_server()

        # –û—Ç—Ä–∏–º—É—î–º–æ —à–≤–∏–¥–∫—ñ—Å—Ç—å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–∞ –≤—ñ–¥–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤ –º–µ–≥–∞–±—ñ—Ç–∞—Ö –∑–∞ —Å–µ–∫—É–Ω–¥—É
        download_speed = st.download() / 1_000_000  # –ü–µ—Ä–µ—Ç–≤–æ—Ä—é—î–º–æ –∑ –±—ñ—Ç/—Å –≤ –ú–±—ñ—Ç/—Å
        upload_speed = st.upload() / 1_000_000  # –ü–µ—Ä–µ—Ç–≤–æ—Ä—é—î–º–æ –∑ –±—ñ—Ç/—Å –≤ –ú–±—ñ—Ç/—Å
        
        # –û—Ç—Ä–∏–º—É—î–º–æ –∑–∞—Ç—Ä–∏–º–∫—É (ping)
        ping = st.results.ping

        # –í–∏–≤–µ–¥–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
        result_message = (
            f"üìä **–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ç–µ—Å—Ç—É —à–≤–∏–¥–∫–æ—Å—Ç—ñ:**\n"
            f"üîΩ **–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è**: {download_speed:.2f} Mbps\n"
            f"üîº **–í—ñ–¥–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è**: {upload_speed:.2f} Mbps\n"
            f"‚è±Ô∏è **–ó–∞—Ç—Ä–∏–º–∫–∞ (ping)**: {ping} ms\n"
            f"üåê **–¢–µ—Å—Ç –ø—Ä–æ–≤–µ–¥–µ–Ω–∏–π –¥–æ —Å–µ—Ä–≤–µ—Ä–∞: {st.results.server['host']}**"
        )
        await message.edit_text(result_message)

    except Exception as e:
        await message.edit_text(f"‚ö†Ô∏è **–°—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—ñ —à–≤–∏–¥–∫–æ—Å—Ç—ñ:** {str(e)}")
